!function(e){e.imgplay=function(t,n){var s={name:"imgplay",rate:1,controls:!0,pageSize:5},a=this,o=t,r=e(t),i=null,l=null,c=!1,u="forward",d=0,m=0,p=[],f=null,g=[],v=0,y=0;a.settings={},a.getTotalFrames=function(){return d},a.controls={play:null,pause:null,stop:null,rewind:null,forward:null,previousFrame:null,nextFrame:null,fullscreen:null},a.getDrawnHeight=function(){return v},a.getDrawnWidth=function(){return y},a.frames=[],a.init=function(){a.settings=e.extend({},s,n),a.settings.rate=a.settings.rate<.001?.001:a.settings.rate,a.settings.rate=a.settings.rate>100?100:a.settings.rate,r.addClass("imgplay"),i=e('<canvas class="imgplay-canvas">'),l=i.get(0).getContext("2d"),r.append(i),w(),r.find("img").each(function(t,n){""!=e(n).prop("src")?a.frames[t]=n:p[t]=n,d++}).detach(),e(window).resize(k),k()},a.isPlaying=function(){return c},a.getCurrentFrame=function(){return m},a.play=function(){c=!0,u="forward",h(),a.settings.controls&&(a.controls.play.addClass("active"),a.controls.stop.removeClass("active"),a.controls.pause.removeClass("active"),a.controls.rewind.removeClass("active"),a.controls.forward.removeClass("active"))},a.pause=function(){c=!1,null!=f&&clearTimeout(f),a.settings.controls&&(a.controls.pause.addClass("active"),a.controls.play.removeClass("active"),a.controls.stop.removeClass("active"),a.controls.rewind.removeClass("active"),a.controls.forward.removeClass("active"))},a.stop=function(){c=!1,m=0,a.settings.controls&&(a.controls.stop.addClass("active"),a.controls.play.removeClass("active"),a.controls.pause.removeClass("active"),a.controls.rewind.removeClass("active"),a.controls.forward.removeClass("active"))},a.rewind=function(e){var e=parseInt(e);e>0&&m>=e&&(u="backward",m-=e,h()),a.settings.controls&&(a.controls.rewind.addClass("active"),a.controls.forward.removeClass("active"),a.controls.stop.removeClass("active"),a.controls.play.removeClass("active"),a.controls.pause.removeClass("active"))},a.forward=function(e){var e=parseInt(e);e>0&&d>=m+e&&(u="forward",m+=e,h()),a.settings.controls&&(a.controls.forward.addClass("active"),a.controls.rewind.removeClass("active"),a.controls.stop.removeClass("active"),a.controls.play.removeClass("active"),a.controls.pause.removeClass("active"))},a.fastRewind=function(e){var e=parseInt(e);e>0&&(u="backward",a.settings.rate=e),h()},a.fastForward=function(e){var e=parseInt(e);e>0&&(u="forward",a.settings.rate=e),h()},a.previous=function(){},a.next=function(){},a.previousFrame=function(){c=!1,u="backward",m--,h()},a.nextFrame=function(){c=!1,u="forward",m++,h()},a.toFrame=function(e){if(e=e<0?0:e,a.frames[e])return m=e,h(),m>a.frames.length-a.settings.pageSize/2&&F(),jQuery.Deferred().resolve();for(a.settings.onLoading&&a.settings.onLoading(!0),m=e,loadFrom=e-.1*a.settings.pageSize,loadFrom<0&&(loadFrom=0);a.frames[loadFrom];)loadFrom++;return F(loadFrom).then(function(){a.settings.onLoading&&a.settings.onLoading(!1),m==e&&h()})},a.fullscreen=function(e){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),a.settings.controls&&a.controls.fullscreen.removeClass("active")):(o.requestFullscreen?o.requestFullscreen():o.msRequestFullscreen?o.msRequestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen&&o.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),a.settings.controls&&a.controls.fullscreen.addClass("active")),setTimeout(function(){k()},2e3)};var w=function(){if(a.settings.controls&&0==r.find(".imgplay-controls").length){var t=e('<div class="imgplay-controls"></div>'),n=e('<div class="imgplay-progress">'),s=e('<div class="imgplay-buttons">'),o=e('<div class="imgplay-load-bar">'),i=e('<div class="imgplay-play-bar">'),l=e('<div class="imgplay-button imgplay-play"><i class="material-icons">play_arrow</i></div>'),c=e('<div class="imgplay-button imgplay-pause"><i class="material-icons">pause</i></div>'),u=e('<div class="imgplay-button imgplay-stop"><i class="material-icons">stop</i></div>'),m=e('<div class="imgplay-button imgplay-previous-frame"><i class="material-icons">skip_previous</i></div>'),p=e('<div class="imgplay-button imgplay-next-frame"><i class="material-icons">skip_next</i></div>'),f=e('<div class="imgplay-button imgplay-fullscreen"><i class="material-icons">fullscreen</i></div>');l.on("click",function(){a.play()}),c.on("click",function(){a.pause()}),u.on("click",function(){a.stop()}),m.on("click",function(){a.previousFrame()}),p.on("click",function(){a.nextFrame()}),f.on("click",function(){a.fullscreen()}),n.on("click",function(t){var n=e(this),s=t.pageX-n.offset().left,o=n.width(),r=Math.floor(s/o*d);a.toFrame(r)}),o.append(i),n.append(o),s.append([l,c,m,u,p,f]),t.append([n,s]),r.append(t),a.controls.play=l,a.controls.pause=c,a.controls.stop=u,a.controls.previousFrame=m,a.controls.nextFrame=p,a.controls.fullscreen=f}},h=function(){if(null!=l){var t=a.frames[m],n=e(t);if(t){if(n.prop("naturalHeight")>0){var s=i.width(),o=i.height(),r=t.width,g=t.height,w=0,C=0;r>=g?(w=s,C=g*(s/r),C>o&&(C=o,w=r*(o/g))):(C=o,w=r*(o/g),w>s&&(w=s,C=g*(s/r))),v=C,y=w,l.clearRect(0,0,s,o),a.settings.center?l.drawImage(t,(s-w)/2,(o-C)/2,w,C):l.drawImage(t,0,0,w,C)}}else if(p.length&&m<d){var k=c;return a.pause(),k&&a.settings.onLoading&&a.settings.onLoading(!0),void F(m,k)}if(m<0||m>a.frames.length)return void a.stop();c&&("forward"==u?(m++,m>a.frames.length-a.settings.pageSize/2&&F()):m--,f=setTimeout(h,Math.ceil(1e3/a.settings.rate))),b()}},F=function(e,t){var n,s=void 0!=e?e:m;if(p.length)for(var o=s;o<a.settings.pageSize+s&&o<p.length;o++){var r=C(o,t);o==e&&(n=r)}return n},C=function(t,n){if(g[t])return g[t];var s=jQuery.Deferred();if(g[t]=s,t<p.length){var o=p[t],r=e(o);r.data("src")&&(r.prop("src",r.data("src")),r.on("load",function(){a.frames[t]=o,b(),n&&t==m+a.settings.pageSize/2&&0==c&&(a.settings.onLoading&&a.settings.onLoading(!1),a.play()),delete g[t],s.resolve()}))}return s},b=function(){if(a.settings.controls){var e=a.frames.length/d*100,t=m/a.frames.length*100;e=e>100?100:e,t=t>100?100:t,r.find(".imgplay-load-bar").css("width",e+"%"),r.find(".imgplay-play-bar").css("width",t+"%")}},k=function(){i.prop({height:r.height(),width:r.width()}),h()};a.fitCanvas=function(){k()},a.init()},e.fn.imgplay=function(t){return this.each(function(){if(void 0==e(this).data("imgplay")){var n=new e.imgplay(this,t);e(this).data("imgplay",n)}})}}(jQuery);